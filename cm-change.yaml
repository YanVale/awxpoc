---
- name: Set ConfigMap on k8s
  hosts: local
  gather_facts: yes
  vars_files:
    - kubectl_vars.yml
  collections:
    - community.kubernetes

  tasks:
    
    #- name: Set Facts
      #set_fact:
        #path: "{{ lookup('file',playbook_dir file=configmap.yaml }}"
        
     - name: Export namespace
     command: export {{NS}}
     tag: exportns  

    - name: Run Kubectl config Context
     command: kubectl config set-context --current --namespace={{NS}}
     tag: k8s_config_context
     
     #- name: Export var
     #command: export {{variable}}
     #tag: exportvars
     
   #- name: Update Configmap
     #command: envsubst < {{path}} | kubectl apply -f -
     #tag: setconfigmap
     
   - name: Start Trigger Pipeline gitlab
     command: curl --request POST --form token=TOKEN --form ref=main --form "variables[UPLOAD_TO_S3]=true" "https://gitlab.example.com/api/v4/projects/123456/trigger/pipeline"
     tag: triggergitlab
     
     
